#!/bin/bash

# Script pour maintenir le port-forward actif pour la d√©mo

set -e

# Couleurs
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
CYAN='\033[0;36m'
RED='\033[0;31m'
NC='\033[0m'

echo -e "${BLUE}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
echo -e "${BLUE}‚ïë     üîå Port-forward Demo (Port 30200)                    ‚ïë${NC}"
echo -e "${BLUE}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
echo ""

# V√©rifier que le namespace existe
if ! kubectl get namespace demo > /dev/null 2>&1; then
    echo -e "${RED}‚úó Le namespace 'demo' n'existe pas${NC}"
    echo ""
    echo -e "${YELLOW}D√©ployez d'abord l'application avec:${NC}"
    echo "  ./demo-scalabilite"
    echo "  Puis choisissez l'option 2 (D√©ploiement initial)"
    echo ""
    exit 1
fi

# V√©rifier que le service existe
if ! kubectl get svc demo-webapp -n demo > /dev/null 2>&1; then
    echo -e "${RED}‚úó Le service 'demo-webapp' n'existe pas${NC}"
    echo ""
    echo -e "${YELLOW}D√©ployez d'abord l'application avec:${NC}"
    echo "  ./demo-scalabilite"
    echo "  Puis choisissez l'option 2 (D√©ploiement initial)"
    echo ""
    exit 1
fi

echo -e "${GREEN}‚úì Service demo-webapp trouv√©${NC}"
echo ""
echo -e "${CYAN}Configuration:${NC}"
echo "  Port local:  30200"
echo "  Service:     demo-webapp.demo:80"
echo ""
echo -e "${YELLOW}‚ö†Ô∏è  Laissez cette fen√™tre ouverte${NC}"
echo -e "${YELLOW}‚ö†Ô∏è  Appuyez sur Ctrl+C pour arr√™ter${NC}"
echo ""

# Lancer le port-forward
echo -e "${CYAN}D√©marrage du port-forward...${NC}"
kubectl port-forward -n demo svc/demo-webapp 30200:80
